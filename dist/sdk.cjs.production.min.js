"use strict";function n(n){return n&&"object"==typeof n&&"default"in n?n.default:n}Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@apollo/client"),t=n(require("cross-fetch")),r=n(require("jwt-decode")),o=require("react"),a=n(o);function i(n,e,t,r,o,a,i){try{var u=n[a](i),c=u.value}catch(n){return void t(n)}u.done?e(c):Promise.resolve(c).then(r,o)}function u(n){return function(){var e=this,t=arguments;return new Promise((function(r,o){var a=n.apply(e,t);function u(n){i(a,r,o,u,c,"next",n)}function c(n){i(a,r,o,u,c,"throw",n)}u(void 0)}))}}function c(){return(c=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n}).apply(this,arguments)}function s(n,e){return e||(e=n.slice(0)),n.raw=e,n}var l,f,p,d,h,m,g,v,k,y,w,x,A,b,$,S,E,T,F,q,C,U,R,I,P,L,O,_,D,N,j,V=(function(n){var e=function(n){var e=Object.prototype,t=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function u(n,e,t){return Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}),n[e]}try{u({},"")}catch(n){u=function(n,e,t){return n[e]=t}}function c(n,e,t,r){var o=Object.create((e&&e.prototype instanceof f?e:f).prototype),a=new b(r||[]);return o._invoke=function(n,e,t){var r="suspendedStart";return function(o,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw a;return{value:void 0,done:!0}}for(t.method=o,t.arg=a;;){var i=t.delegate;if(i){var u=w(i,t);if(u){if(u===l)continue;return u}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if("suspendedStart"===r)throw r="completed",t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);r="executing";var c=s(n,e,t);if("normal"===c.type){if(r=t.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:t.done}}"throw"===c.type&&(r="completed",t.method="throw",t.arg=c.arg)}}}(n,t,a),o}function s(n,e,t){try{return{type:"normal",arg:n.call(e,t)}}catch(n){return{type:"throw",arg:n}}}n.wrap=c;var l={};function f(){}function p(){}function d(){}var h={};h[o]=function(){return this};var m=Object.getPrototypeOf,g=m&&m(m($([])));g&&g!==e&&t.call(g,o)&&(h=g);var v=d.prototype=f.prototype=Object.create(h);function k(n){["next","throw","return"].forEach((function(e){u(n,e,(function(n){return this._invoke(e,n)}))}))}function y(n,e){var r;this._invoke=function(o,a){function i(){return new e((function(r,i){!function r(o,a,i,u){var c=s(n[o],n,a);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==typeof f&&t.call(f,"__await")?e.resolve(f.__await).then((function(n){r("next",n,i,u)}),(function(n){r("throw",n,i,u)})):e.resolve(f).then((function(n){l.value=n,i(l)}),(function(n){return r("throw",n,i,u)}))}u(c.arg)}(o,a,r,i)}))}return r=r?r.then(i,i):i()}}function w(n,e){var t=n.iterator[e.method];if(void 0===t){if(e.delegate=null,"throw"===e.method){if(n.iterator.return&&(e.method="return",e.arg=void 0,w(n,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=s(t,n.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var o=r.arg;return o?o.done?(e[n.resultName]=o.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(n){var e={tryLoc:n[0]};1 in n&&(e.catchLoc=n[1]),2 in n&&(e.finallyLoc=n[2],e.afterLoc=n[3]),this.tryEntries.push(e)}function A(n){var e=n.completion||{};e.type="normal",delete e.arg,n.completion=e}function b(n){this.tryEntries=[{tryLoc:"root"}],n.forEach(x,this),this.reset(!0)}function $(n){if(n){var e=n[o];if(e)return e.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var r=-1,a=function e(){for(;++r<n.length;)if(t.call(n,r))return e.value=n[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return a.next=a}}return{next:S}}function S(){return{value:void 0,done:!0}}return p.prototype=v.constructor=d,d.constructor=p,p.displayName=u(d,i,"GeneratorFunction"),n.isGeneratorFunction=function(n){var e="function"==typeof n&&n.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,d):(n.__proto__=d,u(n,i,"GeneratorFunction")),n.prototype=Object.create(v),n},n.awrap=function(n){return{__await:n}},k(y.prototype),y.prototype[a]=function(){return this},n.AsyncIterator=y,n.async=function(e,t,r,o,a){void 0===a&&(a=Promise);var i=new y(c(e,t,r,o),a);return n.isGeneratorFunction(t)?i:i.next().then((function(n){return n.done?n.value:i.next()}))},k(v),u(v,i,"Generator"),v[o]=function(){return this},v.toString=function(){return"[object Generator]"},n.keys=function(n){var e=[];for(var t in n)e.push(t);return e.reverse(),function t(){for(;e.length;){var r=e.pop();if(r in n)return t.value=r,t.done=!1,t}return t.done=!0,t}},n.values=$,b.prototype={constructor:b,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!n)for(var e in this)"t"===e.charAt(0)&&t.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var e=this;function r(t,r){return i.type="throw",i.arg=n,e.next=t,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var u=t.call(a,"catchLoc"),c=t.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(n,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&t.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===n||"continue"===n)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=n,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(i)},complete:function(n,e){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&e&&(this.next=e),l},finish:function(n){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.finallyLoc===n)return this.complete(t.completion,t.afterLoc),A(t),l}},catch:function(n){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.tryLoc===n){var r=t.completion;if("throw"===r.type){var o=r.arg;A(t)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(n,e,t){return this.delegate={iterator:$(n),resultName:e,nextLoc:t},"next"===this.method&&(this.arg=void 0),l}},n}(n.exports);try{regeneratorRuntime=e}catch(n){Function("r","regeneratorRuntime = r")(e)}}(j={exports:{}}),j.exports),G=e.gql(l||(l=s(["\n  fragment AccountErrorFragment on AccountError {\n    code\n    field\n    message\n  }\n"]))),J=e.gql(f||(f=s(["\n  fragment AddressFragment on Address {\n    id\n    firstName\n    lastName\n    companyName\n    streetAddress1\n    streetAddress2\n    city\n    cityArea\n    postalCode\n    country {\n      code\n      country\n    }\n    countryArea\n    phone\n    isDefaultBillingAddress\n    isDefaultShippingAddress\n  }\n"]))),Q=e.gql(p||(p=s(["\n  ","\n  fragment UserFragment on User {\n    id\n    email\n    firstName\n    lastName\n    isStaff\n    metadata {\n      key\n      value\n    }\n    defaultShippingAddress {\n      ...AddressFragment\n    }\n    defaultBillingAddress {\n      ...AddressFragment\n    }\n    addresses {\n      ...AddressFragment\n    }\n  }\n"])),J),z=e.gql(d||(d=s(["\n  ","\n  ","\n  mutation login($email: String!, $password: String!) {\n    tokenCreate(email: $email, password: $password) {\n      csrfToken\n      token\n      errors {\n        ...AccountErrorFragment\n      }\n      user {\n        ...UserFragment\n      }\n    }\n  }\n"])),G,Q),B=e.gql(h||(h=s(["\n  ","\n  mutation register($input: AccountRegisterInput!) {\n    accountRegister(input: $input) {\n      errors {\n        ...AccountErrorFragment\n      }\n      requiresConfirmation\n    }\n  }\n"])),G),M=e.gql(m||(m=s(["\n  ","\n  mutation refreshToken($csrfToken: String!) {\n    tokenRefresh(csrfToken: $csrfToken) {\n      token\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n"])),G),Y=e.gql(g||(g=s(["\n  ","\n  ","\n  mutation refreshTokenWithUser($csrfToken: String!) {\n    tokenRefresh(csrfToken: $csrfToken) {\n      token\n      user {\n        ...UserFragment\n      }\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n"])),G,Q),H=e.gql(v||(v=s(["\n  ","\n  ","\n  mutation verifyToken($token: String!) {\n    tokenVerify(token: $token) {\n      isValid\n      payload\n      user {\n        ...UserFragment\n      }\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n"])),G,Q),W=e.gql(k||(k=s(["\n  ",'\n  mutation externalAuthenticationUrl(\n    $pluginId: String = "mirumee.authentication.openidconnect"\n    $input: JSONString!\n  ) {\n    externalAuthenticationUrl(pluginId: $pluginId, input: $input) {\n      authenticationData\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n'])),G),K=e.gql(y||(y=s(["\n  ","\n  ",'\n  mutation externalObtainAccessTokens(\n    $pluginId: String = "mirumee.authentication.openidconnect"\n    $input: JSONString!\n  ) {\n    externalObtainAccessTokens(pluginId: $pluginId, input: $input) {\n      token\n      csrfToken\n      user {\n        ...UserFragment\n      }\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n'])),G,Q),X=e.gql(w||(w=s(["\n  ",'\n  mutation externalRefresh(\n    $pluginId: String = "mirumee.authentication.openidconnect"\n    $input: JSONString!\n  ) {\n    externalRefresh(pluginId: $pluginId, input: $input) {\n      token\n      csrfToken\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n'])),G),Z=e.gql(x||(x=s(["\n  ","\n  ",'\n  mutation externalVerify(\n    $pluginId: String = "mirumee.authentication.openidconnect"\n    $input: JSONString!\n  ) {\n    externalVerify(pluginId: $pluginId, input: $input) {\n      isValid\n      verifyData\n      user {\n        ...UserFragment\n        userPermissions {\n          code\n          name\n        }\n      }\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n'])),G,Q),nn=e.gql(A||(A=s(["\n  ",'\n  mutation externalLogout(\n    $pluginId: String = "mirumee.authentication.openidconnect"\n    $input: JSONString!\n  ) {\n    externalLogout(pluginId: $pluginId, input: $input) {\n      logoutData\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n'])),G),en=e.gql(b||(b=s(["\n  ","\n  mutation passwordChange($newPassword: String!, $oldPassword: String!) {\n    passwordChange(newPassword: $newPassword, oldPassword: $oldPassword) {\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n"])),G),tn=e.gql($||($=s(["\n  ","\n  mutation requestPasswordReset(\n    $email: String!\n    $redirectUrl: String!\n    $channel: String!\n  ) {\n    requestPasswordReset(\n      email: $email\n      redirectUrl: $redirectUrl\n      channel: $channel\n    ) {\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n"])),G),rn=e.gql(S||(S=s(["\n  ","\n  ","\n  mutation setPassword($token: String!, $email: String!, $password: String!) {\n    setPassword(token: $token, email: $email, password: $password) {\n      errors {\n        ...AccountErrorFragment\n      }\n      token\n      csrfToken\n      user {\n        ...UserFragment\n      }\n    }\n  }\n"])),Q,G),on=e.gql(E||(E=s(["\n  ","\n  ","\n  mutation requestEmailChange(\n    $channel: String!\n    $newEmail: String!\n    $password: String!\n    $redirectUrl: String!\n  ) {\n    requestEmailChange(\n      channel: $channel\n      newEmail: $newEmail\n      password: $password\n      redirectUrl: $redirectUrl\n    ) {\n      errors {\n        ...AccountErrorFragment\n      }\n      user {\n        ...UserFragment\n      }\n    }\n  }\n"])),Q,G),an=e.gql(T||(T=s(["\n  ","\n  ","\n  mutation confirmEmailChange($channel: String!, $token: String!) {\n    confirmEmailChange(channel: $channel, token: $token) {\n      errors {\n        ...AccountErrorFragment\n      }\n      user {\n        ...UserFragment\n      }\n    }\n  }\n"])),Q,G),un=e.gql(F||(F=s(["\n  ","\n  mutation accountRequestDeletion($channel: String!, $redirectUrl: String!) {\n    accountRequestDeletion(channel: $channel, redirectUrl: $redirectUrl) {\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n"])),G),cn=e.gql(q||(q=s(["\n  ","\n  ","\n  mutation accountDelete($token: String!) {\n    accountDelete(token: $token) {\n      errors {\n        ...AccountErrorFragment\n      }\n      user {\n        ...UserFragment\n      }\n    }\n  }\n"])),Q,G),sn=e.gql(C||(C=s(["\n  ","\n  ","\n  mutation accountUpdate($input: AccountInput!) {\n    accountUpdate(input: $input) {\n      errors {\n        ...AccountErrorFragment\n      }\n      user {\n        ...UserFragment\n      }\n    }\n  }\n"])),Q,G),ln=e.gql(U||(U=s(["\n  ","\n  ","\n  mutation setAccountDefaultAddress($id: ID!, $type: AddressTypeEnum!) {\n    accountSetDefaultAddress(id: $id, type: $type) {\n      errors {\n        ...AccountErrorFragment\n      }\n      user {\n        ...UserFragment\n      }\n    }\n  }\n"])),Q,G),fn=e.gql(R||(R=s(["\n  ","\n  ","\n  mutation deleteAccountAddress($addressId: ID!) {\n    accountAddressDelete(id: $addressId) {\n      errors {\n        ...AccountErrorFragment\n      }\n      user {\n        ...UserFragment\n      }\n    }\n  }\n"])),Q,G),pn=e.gql(I||(I=s(["\n  ","\n  ","\n  ","\n  mutation createAccountAddress($input: AddressInput!) {\n    accountAddressCreate(input: $input) {\n      address {\n        ...AddressFragment\n      }\n      errors {\n        ...AccountErrorFragment\n      }\n      user {\n        ...UserFragment\n      }\n    }\n  }\n"])),J,Q,G),dn=e.gql(P||(P=s(["\n  ","\n  ","\n  ","\n  mutation updateAccountAddress($input: AddressInput!, $id: ID!) {\n    accountAddressUpdate(input: $input, id: $id) {\n      address {\n        ...AddressFragment\n      }\n      errors {\n        ...AccountErrorFragment\n      }\n      user {\n        ...UserFragment\n      }\n    }\n  }\n"])),J,Q,G),hn=e.gql(L||(L=s(["\n  ","\n  ","\n  mutation accountConfirm($email: String!, $token: String!) {\n    confirmAccount(email: $email, token: $token) {\n      user {\n        ...UserFragment\n      }\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n"])),Q,G),mn="undefined"!=typeof window&&!!window.localStorage,gn=e.gql(_||(_=s(["\n  ","\n  query UserDetails {\n    user: me {\n      ...UserFragment\n    }\n    authenticated @client\n    authenticating @client\n  }\n"])),Q),vn=function(n){var e=n.apolloClient,t=n.channel,r=function(){return O.clear(),e.writeQuery({query:gn,data:{authenticating:!1}}),e.resetStore()},o=function(){var n=u(V.mark((function n(r){return V.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:B,variables:{input:c({},r,{channel:t})}});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),a=function(){var n=u(V.mark((function n(){var t,o,a,i;return V.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=O.getAccessToken()){n.next=3;break}throw Error("Token not present");case 3:return n.next=5,e.mutate({mutation:H,variables:{token:a}});case 5:return null!=(t=(i=n.sent).data)&&null!=(o=t.tokenVerify)&&o.isValid||r(),n.abrupt("return",i);case 8:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),i=function(){var n=u(V.mark((function n(t){return V.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:en,variables:c({},t)});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),s=function(){var n=u(V.mark((function n(r){return V.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:tn,variables:c({},r,{channel:t})});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),l=function(){var n=u(V.mark((function n(t){return V.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:W,variables:c({},t)});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),f=function(){var n=u(V.mark((function n(t){return V.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r(),n.next=3,e.mutate({mutation:nn,variables:c({},t)});case 3:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return{changePassword:i,getExternalAccessToken:function(n){return e.mutate({mutation:K,variables:c({},n),update:function(n,e){var t,r=e.data;null!=r&&null!=(t=r.externalObtainAccessTokens)&&t.token&&O.setTokens({accessToken:r.externalObtainAccessTokens.token,csrfToken:r.externalObtainAccessTokens.csrfToken||null})}})},getExternalAuthUrl:l,login:function(n){return e.writeQuery({query:gn,data:{authenticating:!0}}),e.mutate({mutation:z,variables:c({},n),update:function(n,e){var t,r=e.data;null!=r&&null!=(t=r.tokenCreate)&&t.token&&O.setTokens({accessToken:r.tokenCreate.token,csrfToken:r.tokenCreate.csrfToken})}})},logout:r,logoutExternal:f,refreshExternalToken:function(n){return e.mutate({mutation:X,variables:c({},n),update:function(n,e){var t,r=e.data;null!=r&&null!=(t=r.externalRefresh)&&t.token&&O.setAccessToken(r.externalRefresh.token)}})},refreshToken:function(n){void 0===n&&(n=!1);var t=O.getCSRFToken();if(!t)throw Error("csrfToken not present");return e.mutate(n?{mutation:Y,variables:{csrfToken:t},update:function(n,e){var t,o=e.data;null!=o&&null!=(t=o.tokenRefresh)&&t.token?O.setAccessToken(o.tokenRefresh.token):r()}}:{mutation:M,variables:{csrfToken:t},update:function(n,e){var t,o=e.data;null!=o&&null!=(t=o.tokenRefresh)&&t.token?O.setAccessToken(o.tokenRefresh.token):r()}})},register:o,requestPasswordReset:s,setPassword:function(n){return e.mutate({mutation:rn,variables:c({},n),update:function(n,e){var t,r=e.data;null!=r&&null!=(t=r.setPassword)&&t.token&&O.setTokens({accessToken:r.setPassword.token,csrfToken:r.setPassword.csrfToken||null})}})},verifyExternalToken:function(){var n=u(V.mark((function n(t){var r,o,a;return V.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:Z,variables:c({},t)});case 2:return null!=(r=(a=n.sent).data)&&null!=(o=r.externalVerify)&&o.isValid||O.clear(),n.abrupt("return",a);case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),verifyToken:a}},kn=null,yn=function n(e){var o=void 0===e?{}:e,a=o.autoTokenRefresh,i=void 0===a||a,s=o.tokenRefreshTimeSkew,l=void 0===s?120:s,f=o.refreshOnUnauthorized,p=void 0===f||f;return function(){var e=u(V.mark((function e(o,a){var u,s,f,d,h,m,g,v,k,y;return V.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===a&&(a={}),D){e.next=3;break}throw new Error("Could not find Saleor's client instance. Did you forget to call createSaleorClient()?");case 3:if(f=O.getAccessToken(),"refreshToken"!==(null==(u=JSON.parse((null==(s=a.body)?void 0:s.toString())||""))?void 0:u.operationName)){e.next=6;break}return e.abrupt("return",t(o,a));case 6:if(!i||!f){e.next=26;break}if(d=1e3*(r(f).exp-l),e.prev=8,!kn){e.next=14;break}return e.next=12,kn;case 12:e.next=18;break;case 14:if(!(Date.now()>=d)){e.next=18;break}return kn=N.refreshToken(),e.next=18,kn;case 18:e.next=22;break;case 20:e.prev=20,e.t0=e.catch(8);case 22:return e.prev=22,kn=null,e.finish(22);case 25:f=O.getAccessToken();case 26:if(f&&(a.headers=c({},a.headers,{"authorization-bearer":f})),!p||!f){e.next=60;break}return e.next=30,t(o,a);case 30:return m=e.sent,e.next=33,m.clone().json();case 33:if(!(null==(g=e.sent)||null==(h=g.errors)?void 0:h.some((function(n){var e;return"ExpiredSignatureError"===(null==(e=n.extensions)?void 0:e.exception.code)})))){e.next=59;break}if(e.prev=36,!kn){e.next=43;break}return e.next=40,kn;case 40:v=e.sent,e.next=47;break;case 43:return kn=N.refreshToken(),e.next=46,kn;case 46:v=e.sent;case 47:if(null==(k=v.data)||null==(y=k.tokenRefresh)||!y.token){e.next=51;break}return e.abrupt("return",n({autoTokenRefresh:!1,refreshOnUnauthorized:!1})(o,a));case 51:N.logout();case 52:e.next=56;break;case 54:e.prev=54,e.t1=e.catch(36);case 56:return e.prev=56,kn=null,e.finish(56);case 59:return e.abrupt("return",m);case 60:return e.abrupt("return",t(o,a));case 61:case"end":return e.stop()}}),e,null,[[8,20,22,25],[36,54,56,59]])})));return function(n,t){return e.apply(this,arguments)}}()},wn=function(n){return{Query:{fields:{authenticated:{read:function(n,e){return!!(0,e.readField)("id",(0,e.toReference)({__typename:"User"}))}},me:{read:function(n,e){var t=e.canRead,r=(0,e.toReference)({__typename:"User"});return t(r)?r:null}},authenticating:{read:function(e,t){return void 0===e&&(e=n&&!!O.getCSRFToken()),!(0,t.readField)("authenticated")&&e}}}},User:{keyFields:[],fields:{addresses:{merge:!1}}}}},xn=function(n,t){var r=e.createHttpLink({fetch:yn(),uri:n,credentials:"include"}),o=new e.InMemoryCache({typePolicies:wn(t)});return D=new e.ApolloClient({cache:o,link:r}),N=vn({apolloClient:D,channel:""}),D},An=a.createContext(null),bn=function(n){return function(){return function(n){var e=o.useContext(An);if(!e)throw new Error("Could not find saleor's apollo client in the context. Did you forget to wrap the root component in a <SaleorProvider>?");return e[n]}(n)}},$n=bn("auth"),Sn=bn("user");exports.SaleorContext=An,exports.SaleorProvider=function(n){var e=n.client,t=n.children,r=a.useState(e),o=r[0],i=r[1];return a.useEffect((function(){i(e)}),[e]),o?a.createElement(An.Provider,{value:o},t):null},exports.createApolloClient=xn,exports.createFetch=yn,exports.createSaleorClient=function(n){var e,t,r,o,a,i=n.apiUrl,s=n.autologin,l=void 0===s||s,f=n.channel;t=null,r=(e=l)&&mn?localStorage.getItem("_saleorCSRFToken"):null,O={setAccessToken:a=function(n){t=n},setCSRFToken:o=function(n){e&&mn&&(n?localStorage.setItem("_saleorCSRFToken",n):localStorage.removeItem("_saleorCSRFToken")),r=n},getAccessToken:function(){return t},getCSRFToken:function(){return r},setTokens:function(n){var e=n.csrfToken;a(n.accessToken),o(e)},clear:function(){a(null),o(null)}};var p=xn(i,l),d={apolloClient:p,channel:f},h=vn(d),m=function(n){var e=n.apolloClient,t=n.channel,r=vn({apolloClient:e,channel:t}),o=function(){var n=u(V.mark((function n(t){var o;return V.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:cn,variables:{token:t}});case 2:return o=n.sent,r.logout(),n.abrupt("return",o);case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),a=function(){var n=u(V.mark((function n(r){return V.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:un,variables:{channel:t,redirectUrl:r}});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),i=function(){var n=u(V.mark((function n(r){return V.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:an,variables:{channel:t,token:r}});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),s=function(){var n=u(V.mark((function n(r){return V.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:on,variables:c({channel:t},r)});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),l=function(){var n=u(V.mark((function n(t){return V.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:sn,variables:c({},t)});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),f=function(){var n=u(V.mark((function n(t){return V.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:ln,variables:c({},t)});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return{accountDelete:o,accountRequestDeletion:a,confirmEmailChange:i,createAccountAddress:function(){var n=u(V.mark((function n(t){return V.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:pn,variables:c({},t)});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),deleteAccountAddress:function(){var n=u(V.mark((function n(t){return V.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:fn,variables:{addressId:t}});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),requestEmailChange:s,updateAccount:l,updateAccountAddress:function(){var n=u(V.mark((function n(t){return V.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:dn,variables:c({},t)});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),setAccountDefaultAddress:f,confirmAccount:function(){var n=u(V.mark((function n(t){return V.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:hn,variables:c({},t)});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}}(d);return l&&O.getCSRFToken()&&h.refreshToken(!0),{auth:h,user:m,config:{channel:f,setChannel:function(n){return f=n},autologin:l},_internal:{apolloClient:p},getState:function(){return function(n){return n.readQuery({query:gn})}(p)}}},exports.useAuth=$n,exports.useAuthState=function(){var n,t=(n=gn,function(n){var t=o.useContext(An);if(!t)throw new Error("Could not find saleor's apollo client in the context. Did you forget to wrap the root component in a <SaleorProvider>?");return e.useQuery(n,{client:t._internal.apolloClient,fetchPolicy:"cache-only"})}(n)).data;if(!t)throw new Error("Cache query result is undefined. Invalid cache configuration.");return t},exports.useUser=Sn;
//# sourceMappingURL=sdk.cjs.production.min.js.map
